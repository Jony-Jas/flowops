topics:
  execution.commands:
    description: "Commands to control execution lifecycle"
    keySchema: "string"      # runId
    valueSchema: "ExecutionCommandEvent"
    partitions: 3
    replicationFactor: 2
    producers:
      - execution-service
    consumers:
      - execution-engine

  execution.status:
    description: "Status updates from execution engine (flow-level and step-level)"
    keySchema: "string"      # runId
    valueSchema: "FlowStatusEvent | StepStatusEvent"
    partitions: 3
    replicationFactor: 2
    producers:
      - execution-engine
    consumers:
      - execution-service

schemas:
  ExecutionCommandEvent:
    fields:
      - { name: eventType, type: string, enum: [EXECUTION_START, EXECUTION_STOP, EXECUTION_PAUSE, EXECUTION_RESUME] }
      - { name: flowId, type: string }
      - { name: runId, type: string }
      - { name: triggeredBy, type: string }
      - { name: timestamp, type: string }
      - name: steps
        type: array
        optional: true
        items:
          - { name: stepId, type: string }
          - { name: pluginId, type: string }
          - { name: type, type: string, enum: [ACTION, DECISION] }
          - { name: inputs, type: map, keyType: string, valueType: string }
          - { name: outputs, type: map, keyType: string, valueType: string }
          - { name: condition, type: string }
          - name: branches
            type: array
            items:
              - { name: branchId, type: string }
              - { name: condition, type: string }
              - { name: steps, type: array }   # recursive
          - { name: children, type: array }   # recursive
          - name: config
            type: object
            fields:
              - { name: timeoutMs, type: int }
              - { name: retryCount, type: int }
              - { name: retryDelayMs, type: int }

  FlowStatusEvent:
    fields:
      - { name: eventType, type: string, enum: [FLOW_STATUS] }
      - { name: flowId, type: string }
      - { name: runId, type: string }
      - { name: status, type: string, enum: [PENDING, RUNNING, PAUSED, COMPLETED, FAILED, STOPPED] }
      - { name: error, type: string }
      - { name: timestamp, type: string }

  StepStatusEvent:
    fields:
      - { name: eventType, type: string, enum: [STEP_STATUS] }
      - { name: flowId, type: string }
      - { name: runId, type: string }
      - { name: stepId, type: string }
      - { name: status, type: string, enum: [PENDING, RUNNING, COMPLETED, FAILED, SKIPPED, CANCELLED] }
      - { name: error, type: string }
      - { name: timestamp, type: string }
